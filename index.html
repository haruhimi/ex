<!DOCTYPE html>
<html>
<head>
    <title>jsPsych認知課題実験</title>
    <script src="https://unpkg.com/jspsych@7.3.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@1.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.2"></script>
    <link href="https://unpkg.com/jspsych@7.3.3/css/jspsych.css" rel="stylesheet" type="text/css" />
</head>
<body>
    <div id="jspsych-experiment"></div>
    <script>
        const jsPsych = initJsPsych({
            on_finish: function() {
                jsPsych.data.displayData();
            }
        });

        const timeline = [];

        const preload = {
            type: jsPsychPreload,
            images: ['https://raw.githubusercontent.com/haruhimi/ex/e1ef69bbd85d5b2f9dfd97ffa56f2847ea0b6b48/arietty1.jpg'],
            on_success: function() {
                console.log('画像のプリロードに成功しました。');
            },
            on_error: function(file) {
                console.error('画像のロードに失敗しました:', file);
            }
        };
        timeline.push(preload);

        const welcome = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: "実験へようこそ。スペースキーを押して開始してください。",
            choices: [' ']
        };
        timeline.push(welcome);

        const instructions = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: `
                <p>これから画像が表示されます。</p>
                <p>画像が表示されたら、できるだけ早く'F'キーを押してください。</p>
                <p>準備ができたらスペースキーを押してください。</p>
            `,
            choices: [' ']
        };
        timeline.push(instructions);

        const trial = {
            type: jsPsychImageKeyboardResponse,
            stimulus: 'https://raw.githubusercontent.com/haruhimi/ex/e1ef69bbd85d5b2f9dfd97ffa56f2847ea0b6b48/arietty1.jpg',
            choices: ['f'],
            data: {
                task: 'response_time'
            },
            on_load: function() {
                console.log('画像が読み込まれました。');
            },
            on_finish: function(data) {
                console.log('トライアル終了:', data);
            }
        };
        timeline.push(trial);

        const end_screen = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: '実験が終了しました。ご協力ありがとうございました。'
        };
        timeline.push(end_screen);

        jsPsych.run(timeline);
    </script>
</body>
</html>
